template_data_frame_categories <- function(dat_dict, numcases, varnames) {

  dat_output <- dat_dict[, c(varnames, "options"), drop = FALSE]

  # create a NEW empty dataframe with the names from the data dictionary
  dis_output <- data.frame(matrix(ncol = nrow(dat_output), nrow = numcases))

  colnames(dis_output) <- dat_dict[[varnames]]

  categories <- tidyr::unnest(dat_dict)
  categories <- dplyr::filter(categories, !is.na(option_name))

  # take samples for vars with defined options (non empties)
  for (i in unique(categories[[varnames]])) {
    vals <- categories[categories[[varnames]] == i, ]
    vals <- factor(vals$option_code, vals$option_code[vals$option_order_in_set])
    dis_output[[i]] <- sample(vals, numcases, replace = TRUE)
  }

  # multivars <- dat_dict[dat_dict$data_element_valuetype == "MULTI", varnames]

  # if (length(multivars) > 0) {
  #   sample_multivars <- lapply(multivars, sample_cats)
  #   sample_multivars <- do.call(cbind, sample_multivars)

  #   dis_output[, multivars] <- NULL
  #   dis_output <- cbind(dis_output, sample_multivars)
  # }

  dis_output
}


# sample of a single value and NA
sample_single <- function(x, size, prob = 0.1) {
  sample(c(x, NA), size = size, prob = c(prob, 1 - prob), replace = TRUE)
}


# random data for one single "MULTI" variable (split into multiple columns)
sample_cats <- function(categories, cat, numcases) {
  lvls <- as.character(categories[[cat]])
  # define suffixes for column names, e.g. 000, 001, 002, ...
  suffixes <- formatC((1:length(lvls)) - 1, width = 3, format = "d", flag = "0")

  # create columns with randomized lvls with randomized probability
  extra_cols <- sapply(lvls, sample_single, size = numcases, prob = sample(5:15, 1) / 100)
  colnames(extra_cols) <- paste0(cat, "_", suffixes)
  extra_cols
}
